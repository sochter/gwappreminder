(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{101:function(e,t,n){},134:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(13),o=n.n(i),s=(n(101),n(35)),c=n(22),u=n.n(c),l=n(31),d=n(77),m=n.n(d),p=n(17),f=n.n(p),g=function(){var e=Object(l.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.a.get("https://qc3hx0qepd.execute-api.eu-central-1.amazonaws.com/Prod/appointments/",{auth:{username:t.username,password:t.password},params:{startOfToday:f()().startOf("day").toISOString()},validateStatus:function(){return!0}});case 2:if(401!==(n=e.sent).status){e.next=5;break}return e.abrupt("return",{type:"NotAuthenticated"});case 5:if(200!==n.status){e.next=8;break}return console.log("response",n.data),e.abrupt("return",n.data.map(j));case 8:throw Error("unexpected status "+n.status);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),j=function(e){return{id:e.id,name:e.name,location:e.location,start:f()(e.start),end:f()(e.end)}},h=(f()("2021-03-22T09:00:00.000Z"),f()("2021-03-12T10:45:00.000Z"),f()("2021-03-22T17:30:00.000Z"),f()("2021-03-12T07:45:00.000Z"),f()("2021-03-22T17:30:00.000Z"),f()("2021-03-12T07:45:00.000Z"),f()("2021-03-22T18:30:00.000Z"),f()("2021-03-12T13:00:00.000Z"),n(173)),b=n(176),v=n(178),O=n(179),x=n(7),w=Object(h.a)({root:{minWidth:600,margin:"1em"},name:{fontSize:"1.5em"},startEnd:{fontSize:"1em"},location:{textAlign:"left",fontSize:"1em"}}),S=function(e){var t=e.appointment,n=e.onClick,a=w();return Object(x.jsx)(b.a,{className:a.root,onClick:function(){return n(t)},children:Object(x.jsxs)(v.a,{children:[Object(x.jsx)(O.a,{className:a.name,children:t.name}),Object(x.jsxs)(O.a,{className:a.startEnd,gutterBottom:!0,children:[t.start.format("LT")," ",t.end.format("LT")]}),Object(x.jsx)(O.a,{className:a.location,component:"p",color:"textSecondary",children:t.location})]})})},C=n(180),N=n(63),y=n(191),E=n(57),I=n(61),k=n(82),A=function(){return navigator.language.startsWith("de")?"de":"en"},T=Object(a.createContext)({language:"en",setLanguage:function(){}}),F=function(){return Object(a.useContext)(T)},B=function(e){var t,n=e.children,a=function(){var e=Object(E.useStorageState)(localStorage,"language",A()),t=Object(s.a)(e,2),n=t[0],a=t[1];return"de"!==n&&"en"!==n?[A(),a]:[n,a]}(),r=Object(s.a)(a,2),i=r[0],o=r[1];return Object(x.jsx)(T.Provider,{value:{language:i,setLanguage:o},children:Object(x.jsx)(y.a,{messages:(t=i,t.startsWith("de")?Object(N.a)(Object(N.a)({},I),k):I),locale:i,children:n},i)})},L="remindedAppointmentIds",W=function(){try{var e=sessionStorage.getItem(L);return null===e?[]:JSON.parse(e)}catch(t){return console.error(t),[]}},U=function(){var e=Object(l.a)(u.a.mark((function e(t,n,a,r){var i,o,s,c,l;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("entering appointmentREminderhandler"),i=f()(),o=Math.max(t.start.diff(i,"minutes"),0),s=r.formatMessage({id:"notification"},{minutes:o,appointment:t.name}),!n.visualNotification){e.next=9;break}return e.next=7,Notification.requestPermission();case 7:"granted"===e.sent&&new Notification(s);case 9:n.speechNotification&&(c=speechSynthesis.getVoices().filter((function(e){return e.lang.startsWith(a)}))[0],(l=new SpeechSynthesisUtterance(s)).voice=c,speechSynthesis.speak(l)),u=t.id,sessionStorage.setItem(L,JSON.stringify(W().concat(u)));case 11:case"end":return e.stop()}var u}),e)})));return function(t,n,a,r){return e.apply(this,arguments)}}(),P=function(e,t){var n=Object(a.useRef)(),r=Object(C.a)(),i=F().language;Object(a.useEffect)((function(){if(n.current&&(console.log("cleartimeout"),clearTimeout(n.current),n.current=void 0),t){var a=f()(),o=Math.max(t.start.diff(a,"milliseconds")-60*e.mintesBefore*1e3,10);console.log("now",a),console.log("appointment.start",t.start),console.log("set timeout in milliseconds",o,t),console.log("set timeout in mintes",o/1e3/60,t),n.current=setTimeout(U,o,t,e,i,r)}}),[i,r,t,e])},R=n(195),Z=n(188),K=n(189),D=n(185),M=n(190),G=n(196),J=n(187),q=n(193),z=n(182),Y=n(192),H=n(83),Q=n.n(H),V=n(181),X=n(186),$=function(){var e=Object(l.a)(u.a.mark((function e(t){var n,a,r,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"-----BEGIN PUBLIC KEY-----","-----END PUBLIC KEY-----",n=t.substring("-----BEGIN PUBLIC KEY-----".length,t.length-"-----END PUBLIC KEY-----".length),a=n.replaceAll("\n","").replaceAll("\r",""),console.log(a),r=window.atob(a),i=_(r),e.abrupt("return",window.crypto.subtle.importKey("spki",i,{name:"RSA-OAEP",hash:"SHA-1"},!0,["encrypt"]));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),_=function(e){for(var t=new ArrayBuffer(e.length),n=new Uint8Array(t),a=0,r=e.length;a<r;a++)n[a]=e.charCodeAt(a);return t},ee=function(e){for(var t="",n=new Uint8Array(e),a=n.byteLength,r=0;r<a;r++)t+=String.fromCharCode(n[r]);return window.btoa(t)},te=function(){var e=Object(l.a)(u.a.mark((function e(t){var n,a,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$("-----BEGIN PUBLIC KEY-----\nMIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEAvs6MzyjUPt9ms4wrEB43\nW8eO1nPR4KYLVsX9oqP22BZnQZIQfbIw5g8iNlS4TmSwgENrxh/eEkKl48OV2VcI\nkWKNa4uELHkivZDCrVqmoomhCgCBBT957a4OBYFaTetHpwREcyiW8aboze8RS8Ar\nBfSoqDeWZ6JRYGsT1N57uaeQutRnewf6djaXSA/GddWo+H+6wRoSXYvrzhU0ooG4\ngby0CTaWe01UX9P3MJ1sbs5eEfKa8gnYC1hA/lMtifHO/vup0jzvHoSfI6inNGDe\nGFA6o8fa1LrkJK5/CCH90aWgJmKNkQymIgfs751lcIymrceM9k788Hmd1WFLE28m\nU30YcbSplad5vCKaUYWk0uFCc+nAG/ZXKJD94HZiQFZW2ZgFUdWCWJUaLTfKi2pF\n1/MByPv0wGjD89hppgueX7sWZplZF3o8AQbsFu0J+a98qDmUDaiajysMJkwxaxHk\no/vONSkkjwFb/j2NDlt302clW46e+c7WTFfTu2UVd+ek30GljpIvgJ+G5PKs4tww\nncjO9icRCY1rEwufSx0SfM5R5zQp/pTbU+vvf9vT87OLCd2pnmqjwSe6Ron8sw7T\nSdDNC/eVGZ20EH6MKDL8N9k79SAiCqwNywM8s7ZgrJAaSt2jgI00itm+UqhFn35l\n039+We5mDRF1bU4rc8iP4pkCAwEAAQ==\n-----END PUBLIC KEY-----");case 2:return n=e.sent,a=new TextEncoder,e.next=6,window.crypto.subtle.encrypt("RSA-OAEP",n,a.encode(t));case 6:return r=e.sent,e.abrupt("return",ee(r));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ne=Object(h.a)((function(e){return{paper:{marginTop:e.spacing(8),display:"flex",flexDirection:"column",alignItems:"center"},avatar:{margin:e.spacing(1),backgroundColor:e.palette.secondary.main},form:{width:"100%",marginTop:e.spacing(1)},submit:{margin:e.spacing(3,0,2)},error:{color:"red"}}})),ae=function(e){var t=e.loginFailed,n=e.onLogin,r=ne(),i=Object(a.useRef)(null),o=Object(a.useRef)(null);return Object(x.jsxs)(V.a,{component:"main",maxWidth:"xs",children:[Object(x.jsx)(z.a,{}),Object(x.jsxs)("div",{className:r.paper,children:[Object(x.jsx)(q.a,{className:r.avatar,children:Object(x.jsx)(Q.a,{})}),Object(x.jsx)(O.a,{component:"h1",variant:"h5",children:"Sign in"}),Object(x.jsxs)("form",{className:r.form,noValidate:!0,children:[Object(x.jsx)(Y.a,{inputRef:i,variant:"outlined",margin:"normal",required:!0,fullWidth:!0,id:"username",label:"Username",autoComplete:"username",autoFocus:!0}),Object(x.jsx)(Y.a,{inputRef:o,variant:"outlined",margin:"normal",required:!0,fullWidth:!0,label:"Password",type:"password",id:"password",autoComplete:"current-password"}),Object(x.jsx)(J.a,{type:"submit",fullWidth:!0,variant:"contained",color:"primary",className:r.submit,onClick:function(){var e,t,a,r;console.log("usernameRef.current",i.current),console.log("value",null!==(e=null===(t=i.current)||void 0===t?void 0:t.value)&&void 0!==e?e:""),te(null!==(a=null===(r=o.current)||void 0===r?void 0:r.value)&&void 0!==a?a:"").then((function(e){var t,a;n({username:null!==(t=null===(a=i.current)||void 0===a?void 0:a.value)&&void 0!==t?t:"",password:e})}))},children:"Sign In"}),t&&Object(x.jsx)(X.a,{className:r.error,children:"Username or password wrong"})]})]})]})},re=Object(h.a)((function(e){return Object(R.a)({root:{flexGrow:1},menuButton:{marginRight:e.spacing(2)},title:{flexGrow:1}})})),ie={visualNotification:!0,speechNotification:!0,mintesBefore:1};var oe=function(){var e=Object(E.useStorageState)(sessionStorage,"userCredentials",{username:"",password:""}),t=Object(s.a)(e,2),n=t[0],r=t[1],i=function(e){var t=Object(a.useState)({appointments:[],loading:!1,loggedIn:""!==e.username,authorizationFailed:!1}),n=Object(s.a)(t,2),r=n[0],i=n[1];return Object(a.useEffect)((function(){""===e.username?i({appointments:[],loading:!1,loggedIn:!1,authorizationFailed:!1}):g(e).then((function(e){i("type"in e?{appointments:[],loading:!1,loggedIn:!1,authorizationFailed:!0}:{appointments:e,loading:!1,loggedIn:!0,authorizationFailed:!1})})).catch((function(e){console.error("Failed to query appointments",e)}))}),[e]),r}(n),o=i.appointments,c=i.loggedIn,u=i.authorizationFailed,l=re();!function(e,t){var n=W();console.log("skipping",n);var a=f()(),r=e.filter((function(e){return-1===n.indexOf(e.id)})).filter((function(e){return e.end.isAfter(a)}));P(t,r[0])}(o,ie);var d=Object(C.a)(),m=F(),p=m.language,j=m.setLanguage;return Object(a.useEffect)((function(){Notification.requestPermission()})),c?Object(x.jsx)("div",{children:Object(x.jsx)("header",{children:Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("div",{className:l.root,children:Object(x.jsx)(Z.a,{position:"static",children:Object(x.jsxs)(K.a,{children:[Object(x.jsx)(O.a,{variant:"h6",className:l.title}),Object(x.jsx)(D.a,{variant:"outlined",children:Object(x.jsxs)(M.a,{labelId:"demo-simple-select-filled-label",id:"demo-simple-select-filled",value:p,onChange:function(e){j(e.target.value)},children:[Object(x.jsx)(G.a,{value:"en",children:"English"}),Object(x.jsx)(G.a,{value:"de",children:"Deutsch"})]})}),Object(x.jsxs)(J.a,{color:"inherit",onClick:function(){return r({username:"",password:""})},children:["Logout ",n.username]})]})})}),o.map((function(e,t){return Object(x.jsx)(S,{appointment:e,onClick:function(e){U(e,ie,p,d)}},t)}))]})})}):Object(x.jsx)(ae,{loginFailed:u,onLogin:r})},se=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,197)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,i=t.getLCP,o=t.getTTFB;n(e),a(e),r(e),i(e),o(e)}))},ce=n(133);f.a.extend(ce),o.a.render(Object(x.jsx)(r.a.StrictMode,{children:Object(x.jsx)(B,{children:Object(x.jsx)(oe,{})})}),document.getElementById("root")),se()},61:function(e){e.exports=JSON.parse('{"notification":"{minutes, plural, one {# more minute} other {# minutes}} until the appointment {appointment}","test":"engl"}')},82:function(e){e.exports=JSON.parse('{"notification":"Noch {minutes, plural, one {# Minute} other {# Minuten}} bis zum Termin {appointment}","test":"Deu"}')}},[[134,1,2]]]);
//# sourceMappingURL=main.a38bc3dd.chunk.js.map