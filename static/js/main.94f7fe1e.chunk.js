(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{111:function(e,t,n){},144:function(e,t,n){"use strict";n.r(t);var i=n(0),a=n.n(i),o=n(13),r=n.n(o),s=(n(111),n(21)),c=n(25),l=n.n(c),u=n(38),p=n(86),d=n.n(p),f=n(17),g=n.n(f),m=function(){var e=Object(u.a)(l.a.mark((function e(t){var n,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.a.get("https://qc3hx0qepd.execute-api.eu-central-1.amazonaws.com/Prod/appointments/",{auth:{username:t.username,password:t.password},params:{startOfToday:g()().startOf("day").toISOString()},validateStatus:function(){return!0}});case 2:if(401!==(n=e.sent).status){e.next=5;break}return e.abrupt("return",{type:"NotAuthenticated"});case 5:if(200!==n.status){e.next=8;break}return i=g()(),e.abrupt("return",n.data.map(h).filter((function(e){return e.end.isAfter(i)})));case 8:throw Error("unexpected status "+n.status);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),h=function(e){return{id:e.id,name:e.name,location:e.location,start:g()(e.start),end:g()(e.end)}},j=(g()("2021-03-22T09:00:00.000Z"),g()("2021-03-12T10:45:00.000Z"),g()("2021-03-22T17:30:00.000Z"),g()("2021-03-12T07:45:00.000Z"),g()("2021-03-22T17:30:00.000Z"),g()("2021-03-12T07:45:00.000Z"),g()("2021-03-22T18:30:00.000Z"),g()("2021-03-12T13:00:00.000Z"),n(186)),b=n(189),O=n(191),x=n(71),v=n(6),w=Object(j.a)({root:{minWidth:600,margin:"1em"},name:{fontSize:"1.5em"},startEnd:{fontSize:"1em"},location:{textAlign:"left",fontSize:"1em"}}),S=function(e){var t=e.appointment,n=e.onClick,i=w();return Object(v.jsx)(b.a,{className:i.root,onClick:function(){return n(t)},children:Object(v.jsxs)(O.a,{children:[Object(v.jsx)(x.a,{className:i.name,children:t.name}),Object(v.jsxs)(x.a,{className:i.startEnd,gutterBottom:!0,children:[t.start.format("LT")," ",t.end.format("LT")]}),Object(v.jsx)(x.a,{className:i.location,component:"p",color:"textSecondary",children:t.location})]})})},y=n(192),C=n(29),N=n(209),k=n(47),I=n(69),A=n(91),E=function(){return navigator.language.startsWith("de")?"de":"en"},B=Object(i.createContext)({language:"en",setLanguage:function(){}}),T=function(){return Object(i.useContext)(B)},P=function(e){var t,n=e.children,i=function(){var e=Object(k.useStorageState)(localStorage,"language",E()),t=Object(s.a)(e,2),n=t[0],i=t[1];return"de"!==n&&"en"!==n?[E(),i]:[n,i]}(),a=Object(s.a)(i,2),o=a[0],r=a[1];return Object(v.jsx)(B.Provider,{value:{language:o,setLanguage:r},children:Object(v.jsx)(N.a,{messages:(t=o,t.startsWith("de")?Object(C.a)(Object(C.a)({},I),A):I),locale:o,children:n},o)})},F="remindedAppointmentIds",M=function(){try{var e=sessionStorage.getItem(F);return null===e?[]:JSON.parse(e)}catch(t){return console.error(t),[]}},W=function(){var e=Object(u.a)(l.a.mark((function e(t,n,i,a){var o,r,s,c,u;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("entering appointmentReminderhandler"),o=g()(),10,r=Math.max(t.start.diff(o.subtract(10,"seconds"),"minutes"),0),s=a.formatMessage({id:"notification"},{minutes:r,appointment:t.name}),!n.popupNotification){e.next=11;break}return console.log("show popup with notification ".concat(s)),e.next=9,Notification.requestPermission();case 9:"granted"===e.sent&&new Notification(s);case 11:n.speechNotification&&(console.log("speech notification ".concat(s)),c=speechSynthesis.getVoices().filter((function(e){return e.lang.startsWith(i)}))[0],(u=new SpeechSynthesisUtterance(s)).voice=c,speechSynthesis.speak(u)),l=t.id,sessionStorage.setItem(F,JSON.stringify(M().concat(l)));case 13:case"end":return e.stop()}var l}),e)})));return function(t,n,i,a){return e.apply(this,arguments)}}(),L=function(e,t){var n=Object(i.useRef)(),a=Object(y.a)(),o=T().language;Object(i.useEffect)((function(){if(n.current&&(console.log("cleartimeout"),clearTimeout(n.current),n.current=void 0),t){var i=g()(),r=Math.max(t.start.diff(i,"milliseconds")-60*e.mintesBefore*1e3,10);console.log("now",i),console.log("appointment.start",t.start),console.log("set timeout in milliseconds",r,t),console.log("set timeout in mintes",r/1e3/60,t),n.current=setTimeout(W,r,t,e,o,a)}}),[o,a,t,e])},U=n(216),Z=n(206),K=n(207),R=n(199),G=n(197),D=n(208),q=n(217),J=n(214),z=n(194),Y=n(212),H=n(92),Q=n.n(H),V=n(193),X=n(198),_=function(){var e=Object(u.a)(l.a.mark((function e(t){var n,i,a,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"-----BEGIN PUBLIC KEY-----","-----END PUBLIC KEY-----",n=t.substring("-----BEGIN PUBLIC KEY-----".length,t.length-"-----END PUBLIC KEY-----".length),i=n.replaceAll("\n","").replaceAll("\r",""),a=window.atob(i),o=$(a),e.abrupt("return",window.crypto.subtle.importKey("spki",o,{name:"RSA-OAEP",hash:"SHA-1"},!0,["encrypt"]));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),$=function(e){for(var t=new ArrayBuffer(e.length),n=new Uint8Array(t),i=0,a=e.length;i<a;i++)n[i]=e.charCodeAt(i);return t},ee=function(e){for(var t="",n=new Uint8Array(e),i=n.byteLength,a=0;a<i;a++)t+=String.fromCharCode(n[a]);return window.btoa(t)},te=function(){var e=Object(u.a)(l.a.mark((function e(t){var n,i,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_("-----BEGIN PUBLIC KEY-----\nMIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEAvs6MzyjUPt9ms4wrEB43\nW8eO1nPR4KYLVsX9oqP22BZnQZIQfbIw5g8iNlS4TmSwgENrxh/eEkKl48OV2VcI\nkWKNa4uELHkivZDCrVqmoomhCgCBBT957a4OBYFaTetHpwREcyiW8aboze8RS8Ar\nBfSoqDeWZ6JRYGsT1N57uaeQutRnewf6djaXSA/GddWo+H+6wRoSXYvrzhU0ooG4\ngby0CTaWe01UX9P3MJ1sbs5eEfKa8gnYC1hA/lMtifHO/vup0jzvHoSfI6inNGDe\nGFA6o8fa1LrkJK5/CCH90aWgJmKNkQymIgfs751lcIymrceM9k788Hmd1WFLE28m\nU30YcbSplad5vCKaUYWk0uFCc+nAG/ZXKJD94HZiQFZW2ZgFUdWCWJUaLTfKi2pF\n1/MByPv0wGjD89hppgueX7sWZplZF3o8AQbsFu0J+a98qDmUDaiajysMJkwxaxHk\no/vONSkkjwFb/j2NDlt302clW46e+c7WTFfTu2UVd+ek30GljpIvgJ+G5PKs4tww\nncjO9icRCY1rEwufSx0SfM5R5zQp/pTbU+vvf9vT87OLCd2pnmqjwSe6Ron8sw7T\nSdDNC/eVGZ20EH6MKDL8N9k79SAiCqwNywM8s7ZgrJAaSt2jgI00itm+UqhFn35l\n039+We5mDRF1bU4rc8iP4pkCAwEAAQ==\n-----END PUBLIC KEY-----");case 2:return n=e.sent,i=new TextEncoder,e.next=6,window.crypto.subtle.encrypt("RSA-OAEP",n,i.encode(t));case 6:return a=e.sent,e.abrupt("return",ee(a));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ne=Object(j.a)((function(e){return{paper:{marginTop:e.spacing(8),display:"flex",flexDirection:"column",alignItems:"center"},avatar:{margin:e.spacing(1),backgroundColor:e.palette.secondary.main},form:{width:"100%",marginTop:e.spacing(1)},submit:{margin:e.spacing(3,0,2)},error:{color:"red"}}})),ie=function(e){var t=e.loginFailed,n=e.onLogin,a=ne(),o=Object(i.useRef)(null),r=Object(i.useRef)(null),s=Object(y.a)();return Object(v.jsxs)(V.a,{component:"main",maxWidth:"xs",children:[Object(v.jsx)(z.a,{}),Object(v.jsxs)("div",{className:a.paper,children:[Object(v.jsx)(J.a,{className:a.avatar,children:Object(v.jsx)(Q.a,{})}),Object(v.jsx)(x.a,{component:"h1",variant:"h5",children:s.formatMessage({id:"apptitle"})}),Object(v.jsxs)("form",{className:a.form,noValidate:!0,children:[Object(v.jsx)(Y.a,{inputRef:o,variant:"outlined",margin:"normal",required:!0,fullWidth:!0,id:"username",label:"Username",autoComplete:"username",autoFocus:!0}),Object(v.jsx)(Y.a,{inputRef:r,variant:"outlined",margin:"normal",required:!0,fullWidth:!0,label:"Password",type:"password",id:"password",autoComplete:"current-password"}),Object(v.jsx)(R.a,{type:"submit",fullWidth:!0,variant:"contained",color:"primary",className:a.submit,onClick:function(){var e,t;te(null!==(e=null===(t=r.current)||void 0===t?void 0:t.value)&&void 0!==e?e:"").then((function(e){var t,i;n({username:null!==(t=null===(i=o.current)||void 0===i?void 0:i.value)&&void 0!==t?t:"",password:e})}))},children:"Sign In"}),t&&Object(v.jsx)(X.a,{className:a.error,children:"Username or password wrong"})]})]})]})},ae=n(213),oe=n(205),re=n(201),se=n(202),ce=n(200),le=n(203),ue=n(204),pe=n(211),de=Object(j.a)((function(e){return{error:{color:"red"}}})),fe=function(e){var t=e.settings,n=e.open,a=e.onClose,o=e.onApply,r=Object(y.a)(),c=de(),l=Object(i.useState)(),u=Object(s.a)(l,2),p=u[0],d=u[1];return Notification.requestPermission().then((function(e){d(e)})),Object(v.jsxs)(ae.a,{open:n,onClose:a,"aria-labelledby":"form-dialog-title",children:[Object(v.jsx)(ce.a,{id:"form-dialog-title",children:r.formatMessage({id:"settingsdialog.title"})}),Object(v.jsxs)(re.a,{children:[Object(v.jsx)(se.a,{}),Object(v.jsxs)(le.a,{container:!0,direction:"column",justify:"center",alignItems:"flex-start",children:[Object(v.jsx)(Y.a,{id:"standard-number",label:r.formatMessage({id:"settingsdialog.minutesbefore"}),type:"number",InputLabelProps:{shrink:!0},value:t.mintesBefore,onChange:function(e){var n=parseInt(e.target.value);n>=0&&o(Object(C.a)(Object(C.a)({},t),{},{mintesBefore:n}))}}),Object(v.jsx)(ue.a,{control:Object(v.jsx)(pe.a,{checked:t.popupNotification,onChange:function(e){return o(Object(C.a)(Object(C.a)({},t),{},{popupNotification:e.target.checked}))},name:"popupNotification",color:"primary"}),label:r.formatMessage({id:"settingsdialog.popupnotification"})}),t.popupNotification&&void 0!==p&&"granted"!==p&&Object(v.jsx)(X.a,{className:c.error,children:"Please allow notifications for this page in the browser"}),Object(v.jsx)(ue.a,{control:Object(v.jsx)(pe.a,{checked:t.speechNotification,onChange:function(e){return o(Object(C.a)(Object(C.a)({},t),{},{speechNotification:e.target.checked}))},name:"speechNotification",color:"primary"}),label:r.formatMessage({id:"settingsdialog.speechnotification"})}),Object(v.jsx)(X.a,{children:"If you are using chrome, please make sure that you have added this site to the allow section of chrome://settings/content/sound. Otherwise speech synthesis will not work without user interaction on this site. Please note that not all browsers implement speech synthesis. If you do not receive a speech notification, make sure your browser supports it."})]})]}),Object(v.jsx)(oe.a,{children:Object(v.jsx)(R.a,{onClick:a,color:"primary",children:r.formatMessage({id:"settingsdialog.close"})})})]})},ge=Object(j.a)((function(e){return Object(U.a)({root:{flexGrow:1},menuButton:{marginRight:e.spacing(2)},title:{flexGrow:1}})}));var me=function(e){var t=window.open(e,"_blank","noopener,noreferrer");t&&(t.opener=null)},he=function(){var e=Object(k.useStorageState)(sessionStorage,"userCredentials",{username:"",password:""}),t=Object(s.a)(e,2),n=t[0],o=t[1],r=function(e){var t=Object(i.useState)({appointments:[],loading:!1,loggedIn:""!==e.username,authorizationFailed:!1}),n=Object(s.a)(t,2),a=n[0],o=n[1];return Object(i.useEffect)((function(){""===e.username?o({appointments:[],loading:!1,loggedIn:!1,authorizationFailed:!1}):m(e).then((function(e){o("type"in e?{appointments:[],loading:!1,loggedIn:!1,authorizationFailed:!0}:{appointments:e,loading:!1,loggedIn:!0,authorizationFailed:!1})})).catch((function(e){console.error("Failed to query appointments",e)}))}),[e]),a}(n),c=r.appointments,l=r.loggedIn,u=r.authorizationFailed,p=ge(),d=a.a.useState(!1),f=Object(s.a)(d,2),h=f[0],j=f[1],b=function(){var e=Object(k.useStorageState)(localStorage,"reminder0",{popupNotification:!0,speechNotification:!0,mintesBefore:5}),t=Object(s.a)(e,2);return[t[0],t[1]]}(),O=Object(s.a)(b,2),w=O[0],C=O[1];!function(e,t){var n=M();console.log("skipping",n);var i=g()(),a=e.filter((function(e){return-1===n.indexOf(e.id)})).filter((function(e){return e.end.isAfter(i)}));L(t,a[0])}(c,w);var N=Object(y.a)(),I=T(),A=I.language,E=I.setLanguage;return Object(i.useEffect)((function(){Notification.requestPermission()})),l?Object(v.jsx)("div",{children:Object(v.jsx)("header",{children:Object(v.jsxs)(v.Fragment,{children:[Object(v.jsxs)("div",{className:p.root,children:[Object(v.jsx)(fe,{open:h,settings:w,onClose:function(){return j(!1)},onApply:C}),Object(v.jsx)(Z.a,{position:"static",children:Object(v.jsxs)(K.a,{children:[Object(v.jsx)(x.a,{variant:"h6",className:p.title}),Object(v.jsx)(R.a,{color:"inherit",onClick:function(){return j(!0)},children:N.formatMessage({id:"button.settings"})}),Object(v.jsx)(G.a,{variant:"outlined",children:Object(v.jsxs)(D.a,{labelId:"demo-simple-select-filled-label",id:"demo-simple-select-filled",value:A,onChange:function(e){E(e.target.value)},children:[Object(v.jsx)(q.a,{value:"en",children:"English"}),Object(v.jsx)(q.a,{value:"de",children:"Deutsch"})]})}),Object(v.jsxs)(R.a,{color:"inherit",onClick:function(){return o({username:"",password:""})},children:["Logout ",n.username]})]})})]}),c.map((function(e,t){return Object(v.jsx)(S,{appointment:e,onClick:function(e){me("https://portal.itdesign.de/smartdesign/#!type/appointment/0x".concat(e.id))}},t)}))]})})}):Object(v.jsx)(ie,{loginFailed:u,onLogin:o})},je=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,219)).then((function(t){var n=t.getCLS,i=t.getFID,a=t.getFCP,o=t.getLCP,r=t.getTTFB;n(e),i(e),a(e),o(e),r(e)}))},be=n(143);g.a.extend(be),speechSynthesis.getVoices(),r.a.render(Object(v.jsx)(a.a.StrictMode,{children:Object(v.jsx)(P,{children:Object(v.jsx)(he,{})})}),document.getElementById("root")),je()},69:function(e){e.exports=JSON.parse('{"notification":"{minutes, plural, one {# more minute} other {# minutes}} until the appointment {appointment}","apptitle":"GenesisWorld Appointment Notification","button.settings":"Settings","settingsdialog.title":"Settings","settingsdialog.minutesbefore":"Minutes Before","settingsdialog.popupnotification":"Popup Notification","settingsdialog.speechnotification":"Speech Notification","settingsdialog.close":"Close","settingsdialog.pleaseallownotification":"Please allow notifications for this page in the browser"}')},91:function(e){e.exports=JSON.parse('{"notification":"Noch {minutes, plural, one {# Minute} other {# Minuten}} bis zum Termin {appointment}","apptitle":"GenesisWorld Terminbenachrichtigung","button.settings":"Einstellungen","settingsdialog.title":"Einstellungen","settingsdialog.minutesbefore":"Minuten vorher","settingsdialog.popupnotification":"Popup-Benachrichtigung","settingsdialog.speechnotification":"Sprachbenachrichtigung","settingsdialog.close":"Close","settingsdialog.pleaseallownotification":"Bitte Benachrichtigungen f\xfcr diese Seite im Browser erlauben."}')}},[[144,1,2]]]);
//# sourceMappingURL=main.94f7fe1e.chunk.js.map